Ó
LC:\Users\patrick.braga\source\repos\Hero\src\Hero.Infra\Data\AppDbContext.cs
	namespace 	
Infra
 
. 
Data 
{ 
public		 

class		 
AppDbContext		 
:		 
	DbContext		  )
{

 
public 
AppDbContext 
( 
DbContextOptions ,
<, -
AppDbContext- 9
>9 :
options; B
)B C
: 
base 
( 
options 
) 
{ 	
} 	
public 
virtual 
DbSet 
< 
Hero !
>! "
Hero# '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
	protected 
override 
void 
OnConfiguring  -
(- .#
DbContextOptionsBuilder. E
optionsF M
)M N
{ 	
options 
. &
EnableSensitiveDataLogging .
(. /
)/ 0
;0 1
base 
. 
OnConfiguring 
( 
options &
)& '
;' (
} 	
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
base 
. 
OnModelCreating  
(  !
modelBuilder! -
)- .
;. /
modelBuilder 
. 
HasDefaultSchema )
() *
$str* 2
)2 3
;3 4
modelBuilder 
. 
ApplyConfiguration +
(+ ,
new, /"
HeroModelConfiguration0 F
(F G
)G H
)H I
;I J
foreach!! 
(!! 
var!! 
property!! !
in!!" $
modelBuilder!!% 1
.!!1 2
Model!!2 7
.!!7 8
GetEntityTypes!!8 F
(!!F G
)!!G H
."" 

SelectMany"" 
("" 
t"" 
=>"" !
t""" #
.""# $
GetProperties""$ 1
(""1 2
)""2 3
)""3 4
.## 
Where## 
(## 
p## 
=>## 
p## 
.## 
ClrType## &
==##' )
typeof##* 0
(##0 1
DateTime##1 9
)##9 :
||##; =
p##> ?
.##? @
ClrType##@ G
==##H J
typeof##K Q
(##Q R
DateTime##R Z
?##Z [
)##[ \
)##\ ]
)##] ^
{$$ 
property%% 
.%% 
SetColumnType%% &
(%%& '
$str%%' D
)%%D E
;%%E F
}&& 
}'' 	
public)) 
static)) 
void)) 
InitializeDatabase)) -
())- .
IApplicationBuilder)). A
app))B E
)))E F
{** 	
using++ 
var++ 
serviceScope++ "
=++# $
app++% (
.++( )
ApplicationServices++) <
.++< =

GetService++= G
<++G H 
IServiceScopeFactory++H \
>++\ ]
(++] ^
)++^ _
.++_ `
CreateScope++` k
(++k l
)++l m
;++m n
serviceScope,, 
.,, 
ServiceProvider,, (
.,,( )
GetRequiredService,,) ;
<,,; <
AppDbContext,,< H
>,,H I
(,,I J
),,J K
.,,K L
Database,,L T
.,,T U
Migrate,,U \
(,,\ ]
),,] ^
;,,^ _
}-- 	
}.. 
}// ±	
lC:\Users\patrick.braga\source\repos\Hero\src\Hero.Infra\Data\Configurations\Heroes\HeroModelConfiguration.cs
	namespace 	
Infra
 
. 
Data 
. 
Configurations #
.# $
Heroes$ *
{ 
public 

class "
HeroModelConfiguration '
:( )$
IEntityTypeConfiguration* B
<B C
HeroC G
>G H
{ 
public		 
void		 
	Configure		 
(		 
EntityTypeBuilder		 /
<		/ 0
Hero		0 4
>		4 5
entityTypeBuilder		6 G
)		G H
{

 	
entityTypeBuilder 
. 
ToTable %
(% &
$str& .
). /
;/ 0
entityTypeBuilder 
. 
Property &
(& '
e' (
=>) +
e, -
.- .
Nome. 2
)2 3
. 

IsRequired 
( 
) 
. 
	IsUnicode 
( 
true 
)  
;  !
} 	
} 
} „U
[C:\Users\patrick.braga\source\repos\Hero\src\Hero.Infra\Data\Repositories\BaseRepository.cs
	namespace 	
Infra
 
. 
Data 
. 
Repositories !
{ 
public 

class 
BaseRepository 
<  
TEntity  '
>' (
:) *
IBaseRepository+ :
<: ;
TEntity; B
>B C
whereD I
TEntityJ Q
:R S
classT Y
{		 
private

 
readonly

 
AppDbContext

 %
	dbContext

& /
;

/ 0
public 
BaseRepository 
( 
AppDbContext *
	dbContext+ 4
)4 5
{ 	
this 
. 
	dbContext 
= 
	dbContext &
;& '
} 	
public 
virtual 
async 
Task !
<! "
TEntity" )
>) *
GetById+ 2
(2 3
Guid3 7
id8 :
): ;
{ 	
return 
await 
	dbContext "
." #
Set# &
<& '
TEntity' .
>. /
(/ 0
)0 1
.1 2
	FindAsync2 ;
(; <
id< >
)> ?
;? @
} 	
public 
virtual 
async 
Task !
<! "
AsyncOutResult" 0
<0 1
IEnumerable1 <
<< =
TEntity= D
>D E
,E F
intG J
>J K
>K L
GetAllM S
(S T
intT W
?W X
takeY ]
,] ^
int_ b
?b c
offSetd j
,j k
stringl r
sortingProps ~
,~ 
bool
Ä Ñ
?
Ñ Ö
asc
Ü â
)
â ä
{ 	
var 
query 
= 
	dbContext !
.! "
Set" %
<% &
TEntity& -
>- .
(. /
)/ 0
.0 1
AsQueryable1 <
(< =
)= >
;> ?
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
sortingProp& 1
)1 2
&&3 5
asc6 9
!=: <
null= A
)A B
if 
( 
DataHelpers 
.  !
CheckExistingProperty  5
<5 6
TEntity6 =
>= >
(> ?
sortingProp? J
)J K
)K L
query 
= 
query !
.! "
OrderByDynamic" 0
(0 1
sortingProp1 <
,< =
(> ?
bool? C
)C D
ascD G
)G H
;H I
if 
( 
take 
!= 
null 
&& 
offSet  &
!=' )
null* .
). /
return 
new 
AsyncOutResult )
<) *
IEnumerable* 5
<5 6
TEntity6 =
>= >
,> ?
int@ C
>C D
(D E
awaitE J
queryK P
.P Q
SkipQ U
(U V
(V W
intW Z
)Z [
offSet[ a
)a b
.b c
Takec g
(g h
(h i
inti l
)l m
takem q
)q r
.r s
ToListAsyncs ~
(~ 
)	 Ä
,
Ä Å
await
Ç á
query
à ç
.
ç é

CountAsync
é ò
(
ò ô
)
ô ö
)
ö õ
;
õ ú
return!! 
new!! 
AsyncOutResult!! %
<!!% &
IEnumerable!!& 1
<!!1 2
TEntity!!2 9
>!!9 :
,!!: ;
int!!< ?
>!!? @
(!!@ A
await!!A F
query!!G L
.!!L M
ToListAsync!!M X
(!!X Y
)!!Y Z
,!!Z [
await!!\ a
query!!b g
.!!g h

CountAsync!!h r
(!!r s
)!!s t
)!!t u
;!!u v
}"" 	
public$$ 
virtual$$ 
async$$ 
Task$$ !
<$$! "
IEnumerable$$" -
<$$- .
TEntity$$. 5
>$$5 6
>$$6 7
Get$$8 ;
($$; <
int$$< ?
?$$? @
take$$A E
,$$E F
int$$G J
?$$J K
offSet$$L R
,$$R S
string$$T Z
sortingProp$$[ f
,$$f g
bool$$h l
?$$l m
asc$$n q
)$$q r
{%% 	
var&& 
query&& 
=&& 
	dbContext&& !
.&&! "
Set&&" %
<&&% &
TEntity&&& -
>&&- .
(&&. /
)&&/ 0
.&&0 1
AsQueryable&&1 <
(&&< =
)&&= >
;&&> ?
if(( 
((( 
!(( 
string(( 
.(( 
IsNullOrEmpty(( %
(((% &
sortingProp((& 1
)((1 2
&&((3 5
asc((6 9
!=((: <
null((= A
)((A B
if)) 
()) 
DataHelpers)) 
.))  !
CheckExistingProperty))  5
<))5 6
TEntity))6 =
>))= >
())> ?
sortingProp))? J
)))J K
)))K L
query** 
=** 
query** !
.**! "
OrderByDynamic**" 0
(**0 1
sortingProp**1 <
,**< =
(**> ?
bool**? C
)**C D
asc**D G
)**G H
;**H I
if,, 
(,, 
take,, 
!=,, 
null,, 
&&,, 
offSet,,  &
!=,,' )
null,,* .
),,. /
return-- 
await-- 
query-- "
.--" #
Skip--# '
(--' (
(--( )
int--) ,
)--, -
offSet--- 3
)--3 4
.--4 5
Take--5 9
(--9 :
(--: ;
int--; >
)--> ?
take--? C
)--C D
.--D E
ToListAsync--E P
(--P Q
)--Q R
;--R S
return// 
await// 
query// 
.// 
ToListAsync// *
(//* +
)//+ ,
;//, -
}00 	
public22 
virtual22 
async22 
Task22 !
<22! "
TEntity22" )
>22) *
AddAsync22+ 3
(223 4
TEntity224 ;
entity22< B
)22B C
{33 	
await44 
	dbContext44 
.44 
Set44 
<44  
TEntity44  '
>44' (
(44( )
)44) *
.44* +
AddAsync44+ 3
(443 4
entity444 :
)44: ;
;44; <
return55 
entity55 
;55 
}66 	
public88 
virtual88 
async88 
Task88 !
<88! "
IEnumerable88" -
<88- .
TEntity88. 5
>885 6
>886 7
AddRangeAsync888 E
(88E F
IEnumerable88F Q
<88Q R
TEntity88R Y
>88Y Z
entity88[ a
)88a b
{99 	
await:: 
	dbContext:: 
.:: 
Set:: 
<::  
TEntity::  '
>::' (
(::( )
)::) *
.::* +
AddRangeAsync::+ 8
(::8 9
entity::9 ?
)::? @
;::@ A
return;; 
entity;; 
;;; 
}<< 	
public>> 
virtual>> 
async>> 
Task>> !
<>>! "
bool>>" &
>>>& '
DeleteAsync>>( 3
(>>3 4
TEntity>>4 ;
entity>>< B
)>>B C
{?? 	
try@@ 
{AA 
	dbContextBB 
.BB 
SetBB 
<BB 
TEntityBB %
>BB% &
(BB& '
)BB' (
.BB( )
RemoveBB) /
(BB/ 0
entityBB0 6
)BB6 7
;BB7 8
returnCC 
trueCC 
;CC 
}DD 
catchEE 
(EE 
	ExceptionEE 
)EE 
{FF 
returnGG 
falseGG 
;GG 
}HH 
}II 	
publicKK 
virtualKK 
asyncKK 
TaskKK !
<KK! "
boolKK" &
>KK& '
DeleteRangeAsyncKK( 8
(KK8 9
IEnumerableKK9 D
<KKD E
TEntityKKE L
>KKL M

listEntityKKN X
)KKX Y
{LL 	
tryMM 
{NN 
	dbContextOO 
.OO 
SetOO 
<OO 
TEntityOO %
>OO% &
(OO& '
)OO' (
.OO( )
RemoveRangeOO) 4
(OO4 5

listEntityOO5 ?
)OO? @
;OO@ A
returnPP 
truePP 
;PP 
}QQ 
catchRR 
(RR 
	ExceptionRR 
)RR 
{SS 
returnTT 
falseTT 
;TT 
}UU 
}VV 	
publicXX 
virtualXX 
asyncXX 
TaskXX !
<XX! "
boolXX" &
>XX& '
UpdateAsyncXX( 3
(XX3 4
TEntityXX4 ;
entityXX< B
)XXB C
{YY 	
tryZZ 
{[[ 
	dbContext\\ 
.\\ 
Update\\  
(\\  !
entity\\! '
)\\' (
;\\( )
return]] 
true]] 
;]] 
}^^ 
catch__ 
(__ 
	Exception__ 
ex__ 
)__  
{`` 
Logaa 
.aa 
Erroraa 
(aa 
exaa 
,aa 
$straa N
,aaN O
$straaP l
)aal m
;aam n
returnbb 
falsebb 
;bb 
}cc 
}dd 	
publicff 
virtualff 
asyncff 
Taskff !
<ff! "
boolff" &
>ff& '
UpdateRangeAsyncff( 8
(ff8 9
IEnumerableff9 D
<ffD E
TEntityffE L
>ffL M

listEntityffN X
)ffX Y
{gg 	
tryhh 
{ii 
	dbContextjj 
.jj 
UpdateRangejj %
(jj% &

listEntityjj& 0
)jj0 1
;jj1 2
returnkk 
truekk 
;kk 
}ll 
catchmm 
(mm 
	Exceptionmm 
)mm 
{nn 
returnoo 
falseoo 
;oo 
}pp 
}qq 	
}rr 
}ss µ$
bC:\Users\patrick.braga\source\repos\Hero\src\Hero.Infra\Data\Repositories\Heroes\HeroRepository.cs
	namespace 	
Infra
 
. 
Data 
. 
Repositories !
.! "
Heroes" (
{ 
public 

class 
HeroRepository 
:  !
BaseRepository" 0
<0 1
Hero1 5
>5 6
,6 7
IHeroRepository8 G
{		 
private

 
readonly

 
AppDbContext

 %
	dbContext

& /
;

/ 0
public 
HeroRepository 
( 
AppDbContext *
	dbContext+ 4
)4 5
:6 7
base8 <
(< =
	dbContext= F
)F G
{ 	
this 
. 
	dbContext 
= 
	dbContext &
;& '
} 	
public 
async 
Task 
< 
AsyncOutResult (
<( )
IEnumerable) 4
<4 5
Hero5 9
>9 :
,: ;
int< ?
>? @
>@ A
GetB E
(E F
stringF L
nomeM Q
,Q R
intS V
?V W
takeX \
,\ ]
int^ a
?a b
offSetc i
,i j
stringk q
sortingPropr }
,} ~
bool	 É
?
É Ñ
asc
Ö à
)
à â
{ 	
var 
query 
= 
	dbContext !
.! "
Hero" &
. 
Where 
( 
e 
=> 
! 
e 
. 
Deletado '
)' (
. 
AsQueryable 
( 
) 
; 
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +
nome+ /
)/ 0
)0 1
query 
= 
query 
. 
Where #
(# $
e$ %
=>& (
e) *
.* +
Nome+ /
./ 0
ToLower0 7
(7 8
)8 9
.9 :

StartsWith: D
(D E
nomeE I
.I J
ToLowerJ Q
(Q R
)R S
)S T
)T U
;U V
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
sortingProp& 1
)1 2
&&3 5
asc6 9
!=: <
null= A
)A B
if 
( 
DataHelpers 
.  !
CheckExistingProperty  5
<5 6
Hero6 :
>: ;
(; <
sortingProp< G
)G H
)H I
query 
= 
query !
.! "
OrderByDynamic" 0
(0 1
sortingProp1 <
,< =
(> ?
bool? C
)C D
ascD G
)G H
;H I
if 
( 
take 
!= 
null 
&& 
offSet  &
!=' )
null* .
). /
return 
new 
AsyncOutResult )
<) *
IEnumerable* 5
<5 6
Hero6 :
>: ;
,; <
int= @
>@ A
(A B
awaitB G
queryH M
.M N
SkipN R
(R S
(S T
intT W
)W X
offSetX ^
)^ _
._ `
Take` d
(d e
(e f
intf i
)i j
takej n
)n o
.o p
ToListAsyncp {
({ |
)| }
,} ~
await	 Ñ
query
Ö ä
.
ä ã

CountAsync
ã ï
(
ï ñ
)
ñ ó
)
ó ò
;
ò ô
return!! 
new!! 
AsyncOutResult!! %
<!!% &
IEnumerable!!& 1
<!!1 2
Hero!!2 6
>!!6 7
,!!7 8
int!!9 <
>!!< =
(!!= >
await!!> C
query!!D I
.!!I J
ToListAsync!!J U
(!!U V
)!!V W
,!!W X
await!!Y ^
query!!_ d
.!!d e

CountAsync!!e o
(!!o p
)!!p q
)!!q r
;!!r s
}"" 	
}## 
}$$ ı
JC:\Users\patrick.braga\source\repos\Hero\src\Hero.Infra\Data\UnitOfWork.cs
	namespace 	
Infra
 
. 
Data 
{ 
public 

class 

UnitOfWork 
: 
IUnitOfWork )
{ 
private 
readonly 
AppDbContext %
_appDbContext& 3
;3 4
public

 

UnitOfWork

 
(

 
AppDbContext

 &
appDbContext

' 3
)

3 4
=>

5 7
_appDbContext

8 E
=

F G
appDbContext

H T
;

T U
public 
void #
CreateExecutionStrategy +
(+ ,
), -
=>. 0
_appDbContext1 >
.> ?
Database? G
.G H#
CreateExecutionStrategyH _
(_ `
)` a
;a b
public !
IDbContextTransaction $
OpenTransaction% 4
(4 5
)5 6
=>7 9
_appDbContext: G
.G H
DatabaseH P
.P Q
BeginTransactionQ a
(a b
)b c
;c d
public 
void 
RollbackTransaction '
(' (
)( )
=>* ,
_appDbContext- :
.: ;
Database; C
.C D
RollbackTransactionD W
(W X
)X Y
;Y Z
public 
async 
Task "
CommitTransactionAsync 0
(0 1
)1 2
{ 	
await 
_appDbContext 
.  
SaveChangesAsync  0
(0 1
)1 2
;2 3
await 
_appDbContext 
.  
Database  (
.( )"
CommitTransactionAsync) ?
(? @
)@ A
;A B
} 	
public 
void 
Dispose 
( 
) 
=>  
_appDbContext! .
.. /
Dispose/ 6
(6 7
)7 8
;8 9
} 
} ´
bC:\Users\patrick.braga\source\repos\Hero\src\Hero.Infra\Migrations\20230104204552_InitialCreate.cs
	namespace 	
Infra
 
. 

Migrations 
{ 
public		 

partial		 
class		 
InitialCreate		 &
:		' (
	Migration		) 2
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
EnsureSchema )
() *
name 
: 
$str 
) 
;  
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
schema 
: 
$str  
,  !
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
type, 0
:0 1
$str2 8
,8 9
nullable: B
:B C
falseD I
)I J
,J K
Nome 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
Ativo 
= 
table !
.! "
Column" (
<( )
bool) -
>- .
(. /
type/ 3
:3 4
$str5 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
Deletado 
= 
table $
.$ %
Column% +
<+ ,
bool, 0
>0 1
(1 2
type2 6
:6 7
$str8 A
,A B
nullableC K
:K L
falseM R
)R S
,S T
DataCadastro  
=! "
table# (
.( )
Column) /
</ 0
DateTime0 8
>8 9
(9 :
type: >
:> ?
$str@ ]
,] ^
nullable_ g
:g h
falsei n
)n o
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 0
,0 1
x2 3
=>4 6
x7 8
.8 9
Id9 ;
); <
;< =
} 
) 
; 
}   	
	protected## 
override## 
void## 
Down##  $
(##$ %
MigrationBuilder##% 5
migrationBuilder##6 F
)##F G
{$$ 	
migrationBuilder%% 
.%% 
	DropTable%% &
(%%& '
name&& 
:&& 
$str&& 
,&& 
schema'' 
:'' 
$str''  
)''  !
;''! "
}(( 	
})) 
}** 